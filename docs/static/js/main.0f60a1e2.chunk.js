(this["webpackJsonpra-example-oauth"]=this["webpackJsonpra-example-oauth"]||[]).push([[0],{438:function(e,t,r){e.exports=r(804)},439:function(e,t,r){},804:function(e,t,r){"use strict";r.r(t);r(439);var n=r(0),a=r.n(n),o=r(39),c=r.n(o),i=r(407),s=r(823),u=r(822),l=r(820),p=r(821),f=r(357);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var d=function(e){var t=JSON.parse(e),r=JSON.parse(window.atob(t.id_token.split(".")[1]));return console.log(r),function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(r,!0).forEach((function(t){Object(f.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({id:"my-profile"},r)},b=function(e,t,r){if("profile"===t&&"GET_ONE"===e){var n=window.localStorage.getItem("token");if(!n)return Promise.resolve({data:null});var a=d(n);return Promise.resolve({data:a})}switch(e){case"GET_LIST":return{data:[{id:"id",name:"Resource",date:new Date}],total:1};default:return null}},g=r(265),h=r.n(g),O=r(358),v=r(189),j=r(359),w="https://ra-example-oidc-api.kmaschta.now.sh",y=new j.UserManager({authority:"https://accounts.google.com/",client_id:"168557574535-f673145q3s1ughg9fvh2tv8ptd7ef33l.apps.googleusercontent.com",redirect_uri:"https://marmelab.com/ra-example-oauth",response_type:"code",scope:"openid email profile"}),P=function(){window.history.replaceState({},window.document.title,window.location.origin)},k=function(){var e=Object(O.a)(h.a.mark((function e(t){var r,n,a,o,c,i,s,u,l,p=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.length>1&&void 0!==p[1]?p[1]:{},t!==v.d){e.next=20;break}if(r.code&&r.state){e.next=5;break}return y.signinRedirect(),e.abrupt("return");case 5:return n="oidc.".concat(r.state),a=JSON.parse(localStorage.getItem(n)||"{}"),o=a.code_verifier,e.next=9,fetch("".concat(w,"/code-to-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r.code,code_verifier:o})});case 9:if((c=e.sent).ok){e.next=13;break}return P(),e.abrupt("return",Promise.reject());case 13:return e.next=15,c.json();case 15:return i=e.sent,localStorage.setItem("token",JSON.stringify(i)),y.clearStaleState(),P(),e.abrupt("return",Promise.resolve());case 20:if(![v.e,v.b].includes(t)){e.next=23;break}return localStorage.removeItem("token"),e.abrupt("return",Promise.resolve());case 23:if(t!==v.a){e.next=30;break}if(s=localStorage.getItem("token")){e.next=27;break}return e.abrupt("return",Promise.reject());case 27:return u=d(s),l=new Date,e.abrupt("return",l.getTime()>1e3*u.exp?Promise.reject():Promise.resolve());case 30:return e.abrupt("return",Promise.resolve());case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=r(824),S=r(406),x=r(11),N=r(36),_=r(4),D=r(193),G=r.n(D),I=r(26),J=r.n(I),L=r(71),T=r.n(L),R={userLogin:N.h},C=Object(x.b)(void 0,R)(Object(_.withStyles)((function(e){var t=e.spacing;return Object(_.createStyles)({button:{width:"100%"},icon:{marginRight:t.unit}})}))((function(e){var t=e.classes,r=e.userLogin,o=Object(n.useState)(!1),c=Object(S.a)(o,2),i=c[0],s=c[1];Object(n.useEffect)((function(){var e=new URL(window.location.href).searchParams,t=e.get("code"),n=e.get("state");t&&n&&(s(!0),r({code:t,state:n}))}),[r]);return a.a.createElement("div",null,a.a.createElement(G.a,null,a.a.createElement(J.a,{className:t.button,variant:"raised",type:"submit",color:"primary",onClick:function(){s(!0),r()},disabled:i},i&&a.a.createElement(T.a,{className:t.icon,size:18,thickness:2}),"Login With Google")))}))),M=function(e){return a.a.createElement(E.a,Object.assign({},e,{loginForm:a.a.createElement(C,null)}))},U=r(409),B=r(367),q=r(368),z=r(408),A=r(369),F=r(410),W=r(370),H=r(816),K=function(e){function t(){var e,r;Object(B.a)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(r=Object(z.a)(this,(e=Object(A.a)(t)).call.apply(e,[this].concat(a)))).fetchProfile=function(){r.props.crudGetOne("profile","my-profile","/my-profile",!1)},r}return Object(F.a)(t,e),Object(q.a)(t,[{key:"componentDidMount",value:function(){this.fetchProfile()}},{key:"render",value:function(){var e=this.props,t=(e.crudGetOne,e.profile),r=Object(U.a)(e,["crudGetOne","profile"]);console.log("profile",t);var n=t&&t.picture?a.a.createElement("img",{src:t.picture,width:"48",height:"48"}):void 0;return a.a.createElement(W.a,Object.assign({label:t?t.name:"Unknown",icon:n},r))}}]),t}(n.Component),Q=Object(x.b)((function(e){var t=e.admin.resources.profile;return{profile:t?t.data["my-profile"]:null}}),{crudGetOne:H.b})(K),V=function(e){return a.a.createElement(i.a,Object.assign({},e,{userMenu:a.a.createElement(Q,null)}))};c.a.render(a.a.createElement(u.a,{dataProvider:b,authProvider:k,loginPage:M,appLayout:function(e){return a.a.createElement(s.a,Object.assign({},e,{appBar:V}))}},a.a.createElement(l.a,{name:"resource",list:p.a}),a.a.createElement(l.a,{name:"profile"})),document.getElementById("root"))}},[[438,1,2]]]);
//# sourceMappingURL=main.0f60a1e2.chunk.js.map